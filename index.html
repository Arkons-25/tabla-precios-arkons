<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Presupuesto Arquitect√≥nico | ARKONS</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap');
        
        body {
            font-family: 'Montserrat', sans-serif;
            background-color: #f7fafc;
        }

        .dot-pattern {
            background-image: radial-gradient(#ffffff 1px, transparent 1px);
            background-size: 24px 24px;
        }
        
        .step-content {
            display: none;
        }
        .step-content.active {
            display: block;
        }
        
        .input-field {
            @apply w-full mt-1 p-3 border border-gray-300 rounded-lg focus:ring-gray-800 focus:border-gray-800 outline-none transition-all;
        }

        .card {
            @apply bg-white p-6 shadow-2xl rounded-2xl;
        }

        /* ESTILO DE PAQUETES - RESALTADO MEJORADO */
        .package-select {
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            @apply border-2 border-gray-200 relative overflow-hidden bg-white;
        }

        .package-select.selected {
            border-color: #000000 !important;
            border-width: 4px !important;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25) !important;
            transform: scale(1.05);
            z-index: 20;
        }

        .package-select.selected .package-header {
            background-color: #000000 !important;
        }

        .package-select.selected .check-icon {
            display: flex !important;
        }
        
        .check-icon {
            display: none;
            @apply absolute top-2 right-2 text-white bg-green-500 rounded-full w-8 h-8 items-center justify-center text-sm z-30 shadow-lg;
        }
        
        /* Botones Llamativos (Estilo Original Estable) */
        .btn-primary {
            @apply bg-gray-900 text-white font-bold py-4 px-8 rounded-xl transition-all duration-300 shadow-lg hover:shadow-2xl hover:bg-black active:scale-95 flex items-center justify-center gap-2;
        }
        .btn-secondary {
            @apply bg-white text-gray-800 font-bold py-4 px-8 rounded-xl transition-all duration-300 border border-gray-300 shadow-sm hover:bg-gray-50 active:scale-95 flex items-center justify-center gap-2;
        }

        .rec-sec-input {
            @apply !p-1 !mt-0 !w-16 text-center border-gray-400 text-sm rounded;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Encabezado ARKONS con Logo -->
    <header class="bg-white shadow-sm border-b border-gray-200 relative pb-12">
        <div class="h-40 bg-gray-900 w-full relative overflow-hidden flex items-center justify-center">
            <div class="absolute inset-0 opacity-5 dot-pattern"></div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative text-center -mt-24">
            <div class="inline-block relative bg-white p-6 rounded-2xl shadow-xl border border-gray-100">
                <img src="LOGO 2024.png" onerror="this.onerror=null;this.src='https://placehold.co/150x150/333333/ffffff?text=ARKONS';" alt="ARKONS" class="h-32 object-contain mx-auto">
            </div>
            <div class="mt-4">
                <h1 class="text-3xl font-extrabold text-gray-900 tracking-tight uppercase">Calculadora de Presupuesto</h1>
                <p class="text-lg text-gray-500 font-light mt-1 uppercase tracking-widest">Dise√±o y Anteproyecto Arquitect√≥nico</p>
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-4xl w-full mx-auto px-4 py-8">
        
        <form id="architectureForm" class="card">
            <input type="hidden" id="scriptUrl" value="https://script.google.com/macros/s/AKfycbzF8HBuVcXsjaOPOt_ir6Q7SrfQkLSZC9-wcs0SEBwk-R0PhEhBZ_usFG52fluALhI41A/exec">

            <!-- Modal de Mensajes -->
            <div id="messageBox" class="hidden fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4">
                <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center">
                    <div id="loadingIndicator" class="animate-spin rounded-full h-12 w-12 border-t-4 border-gray-900 mx-auto mb-4"></div>
                    <p id="messageText" class="text-lg font-semibold text-gray-800 mb-6"></p>
                    <button type="button" onclick="closeModal()" id="closeMessage" class="w-full btn-primary hidden">Entendido</button>
                </div>
            </div>

            <!-- PASO 1: √ÅREAS Y REQUERIMIENTOS -->
            <div id="step1" class="step-content active">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b pb-2 uppercase tracking-tighter">1. Espacios Requeridos</h2>
                
                <!-- MOVIDO DE PASO 2: TIPO DE OBRA -->
                <div class="mb-8 bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <label class="block text-sm font-bold text-gray-700 mb-2 uppercase tracking-widest">Tipo de Obra</label>
                    <select id="tipoProyecto" class="input-field bg-white">
                        <option value="Casa Residencial">Casa Residencial</option>
                        <option value="Remodelaci√≥n Mayor">Remodelaci√≥n Mayor</option>
                        <option value="Remodelaci√≥n de fachada">Remodelaci√≥n de fachada</option>
                        <option value="Local/Oficina">Local Comercial / Oficinas</option>
                    </select>
                </div>

                <label class="block text-sm font-bold text-gray-700 mb-4 uppercase tracking-widest">Seleccione las √Åreas del Proyecto:</label>
                <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 mb-6">
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Sala" data-sqm="15" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Sala</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(15 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Comedor" data-sqm="12" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Comedor</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(12 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Cocina" data-sqm="10" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Cocina</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(10 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="¬Ω Ba√±o" data-sqm="3" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">¬Ω Ba√±o</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(3 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Ba√±o Completo" data-sqm="5" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Ba√±o Completo</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(5 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Estudio" data-sqm="8" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Estudio</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(8 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Terraza" data-sqm="18" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Terraza</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(18 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Alberca" data-sqm="25" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Alberca</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(25 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Cochera 2 Autos" data-sqm="36" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Cochera 2</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(36 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Cochera 1 Auto" data-sqm="18" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Cochera 1</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(18 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Lavander√≠a" data-sqm="4" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Lavander√≠a</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(4 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Rec. Principal" data-sqm="20" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Rec. Principal (Con Ba√±o)</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(20 m¬≤)</span>
                    </label>
                    <label class="flex flex-col p-3 border rounded-xl cursor-pointer hover:bg-gray-50 transition-colors">
                        <div class="flex items-center"><input type="checkbox" name="areasSeleccionadas" value="Cuarto TV" data-sqm="15" onchange="updateM2()"><span class="ml-2 text-sm font-semibold">Cuarto TV</span></div>
                        <span class="text-[10px] text-gray-400 mt-1">(15 m¬≤)</span>
                    </label>
                </div>

                <div class="grid md:grid-cols-2 gap-4 mb-6">
                    <div class="p-4 bg-gray-50 rounded-xl border flex items-center justify-between">
                        <label class="flex items-center cursor-pointer"><input type="checkbox" id="checkSec" onchange="toggleSec(); updateM2()"><span class="ml-2 text-sm font-bold">Rec. Secundarias</span></label>
                        <div id="secContainer" class="hidden flex items-center gap-1">
                            <input type="number" id="numSec" value="1" min="1" class="rec-sec-input" oninput="updateM2()">
                            <span class="text-[10px] font-bold text-gray-400">x 12m¬≤</span>
                        </div>
                    </div>
                    <div class="p-4 bg-gray-50 rounded-xl border flex items-center justify-between">
                        <label class="flex items-center cursor-pointer">
                            <input type="checkbox" id="checkOtro" onchange="toggleOtro(); updateM2()">
                            <div class="ml-2">
                                <span class="text-sm font-bold block">Otra</span>
                                <span class="text-[10px] text-gray-500 font-normal">(Escriba los m¬≤)</span>
                            </div>
                        </label>
                        <div id="otroContainer" class="hidden flex items-center gap-1">
                            <input type="number" id="numOtro" value="1" min="1" class="rec-sec-input" oninput="updateM2()">
                            <span class="text-[10px] font-bold text-gray-400">m¬≤</span>
                        </div>
                    </div>
                </div>

                <div class="p-4 bg-gray-100 rounded-xl mb-6 flex justify-between items-center border-l-8 border-gray-900 shadow-inner">
                    <span class="font-bold text-gray-600 uppercase text-xs tracking-widest">Total Construcci√≥n Seleccionada:</span>
                    <span id="totalM2" class="text-2xl font-black text-gray-900">0.00 m¬≤</span>
                </div>

                <div class="mb-8">
                    <label class="block text-sm font-bold text-gray-700 mb-2 uppercase tracking-widest">Detalles Adicionales del Proyecto</label>
                    <textarea name="detalles" id="detalles" rows="5" class="input-field w-full" placeholder="Ej. Estilo minimalista, acabados en piedra, etc."></textarea>
                </div>

                <div class="flex justify-end">
                    <button type="button" onclick="nextStep(2)" class="btn-primary">Siguiente <i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <!-- PASO 2: TERRENO Y ALCANCE -->
            <div id="step2" class="step-content">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b pb-2 uppercase tracking-tighter">2. Terreno y Alcance</h2>
                
                <div class="mb-8 bg-gray-50 p-4 rounded-xl border border-gray-200">
                    <label class="block text-sm font-bold text-gray-700 mb-3 uppercase tracking-widest text-center">¬øC√≥mo es la forma de su terreno?</label>
                    <div class="flex justify-center gap-8">
                        <label class="flex items-center cursor-pointer group">
                            <input type="radio" name="terrenoIrregular" value="No" checked onchange="toggleIrregularInputs('No')" class="form-radio text-gray-900 w-5 h-5">
                            <span class="ml-2 text-sm font-semibold group-hover:text-black">Regular (Rectangular)</span>
                        </label>
                        <label class="flex items-center cursor-pointer group">
                            <input type="radio" name="terrenoIrregular" value="S√≠" onchange="toggleIrregularInputs('S√≠')" class="form-radio text-gray-900 w-5 h-5">
                            <span class="ml-2 text-sm font-semibold group-hover:text-black">Irregular</span>
                        </label>
                    </div>
                </div>

                <div id="containerRegular" class="grid grid-cols-2 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-bold text-gray-700 uppercase tracking-tighter">Largo (m)</label>
                        <input type="number" id="tLargo" class="input-field" placeholder="0.00" oninput="calcTerreno()">
                    </div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 uppercase tracking-tighter">Ancho (m)</label>
                        <input type="number" id="tAncho" class="input-field" placeholder="0.00" oninput="calcTerreno()">
                    </div>
                </div>

                <div id="containerIrregular" class="hidden mb-6">
                    <label class="block text-sm font-bold text-gray-700 uppercase tracking-tighter">Metros Cuadrados Totales del Terreno (m¬≤)</label>
                    <input type="number" id="tAreaManual" class="input-field" placeholder="Ingrese el √°rea total manualmente" oninput="calcTerreno()">
                </div>

                <div class="p-4 bg-gray-900 text-white rounded-xl mb-8 flex justify-between items-center shadow-lg">
                    <span class="text-xs font-bold uppercase tracking-widest opacity-70">Superficie Total del Terreno:</span>
                    <span id="tArea" class="font-black text-xl">0.00 m¬≤</span>
                </div>

                <div class="flex justify-between">
                    <button type="button" onclick="nextStep(1)" class="btn-secondary"><i class="fas fa-arrow-left"></i> Anterior</button>
                    <button type="button" onclick="prepareStep3()" class="btn-primary">Ver Presupuesto <i class="fas fa-calculator"></i></button>
                </div>
            </div>

            <!-- PASO 3: SELECCI√ìN DE PAQUETE Y COSTO -->
            <div id="step3" class="step-content">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b pb-2 uppercase tracking-tighter">3. Selecci√≥n de Paquete y Costo</h2>
                
                <p class="text-sm text-gray-500 mb-4 text-center italic font-bold">‚ö†Ô∏è Seleccione una tarjeta para calcular el total:</p>

                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <!-- Esencial -->
                    <div id="packageEsencial" class="package-select card !p-0" onclick="selectPackageAndCalc('Esencial')">
                        <div class="check-icon"><i class="fas fa-check"></i></div>
                        <!-- Header m√°s grande -->
                        <div class="package-header bg-gray-500 text-white p-4 flex justify-between items-center transition-all duration-300">
                            <span class="font-bold uppercase tracking-widest text-base">Esencial</span>
                            <span class="text-2xl font-black">$80/m¬≤</span>
                        </div>
                        <!-- Contenido con letra m√°s legible (text-sm) -->
                        <div class="p-5 text-sm text-gray-700 space-y-2">
                            <ul class="space-y-2">
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Plantas Arquitect√≥nicas (con medidas)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Fachadas Arquitect√≥nicas (con medidas)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>2 Renders de Fachada (representaci√≥n en 3D)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>1 Ronda de cambios</li>
                            </ul>
                            <div class="mt-3 border-t pt-2">
                                <p class="font-bold text-gray-900">M√≠nimo: $4,000 MXN</p>
                                <p class="text-xs text-gray-500 italic">(Para proyectos menores a 50 m¬≤)</p>
                            </div>
                        </div>
                    </div>

                    <!-- Avanzado -->
                    <div id="packageAvanzado" class="package-select card !p-0" onclick="selectPackageAndCalc('Avanzado')">
                        <div class="check-icon"><i class="fas fa-check"></i></div>
                        <!-- Header m√°s grande -->
                        <div class="package-header bg-gray-500 text-white p-4 flex justify-between items-center transition-all duration-300">
                            <span class="font-bold uppercase tracking-widest text-base">Avanzado ‚≠ê</span>
                            <span class="text-2xl font-black">$130/m¬≤</span>
                        </div>
                        <!-- Contenido con letra m√°s legible (text-sm) -->
                        <div class="p-5 text-sm text-gray-700 space-y-2">
                            <ul class="space-y-2">
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Plantas Arquitect√≥nicas (con ejes y medidas)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Fachadas Arquitect√≥nicas (con medidas)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>3-5 Renders de Fachada (representaci√≥n en 3D)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>Recorrido Virtual (Video)</li>
                                <li><i class="fas fa-check text-green-500 mr-2"></i>2 Rondas de cambios</li>
                            </ul>
                            <div class="mt-3 border-t pt-2">
                                <p class="font-bold text-gray-900">M√≠nimo: $6,500 MXN</p>
                                <p class="text-xs text-gray-500 italic">(Para proyectos menores a 50 m¬≤)</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="space-y-3 mb-8">
                    <div class="flex justify-between p-3 bg-gray-50 rounded-xl"><span class="text-gray-500 font-bold uppercase text-[10px] tracking-widest">Construcci√≥n Total:</span> <span id="resM2" class="font-black text-gray-900"></span></div>
                    
                    <div class="bg-black text-white p-6 rounded-3xl shadow-2xl text-left">
                        <p class="text-[9px] uppercase tracking-[0.4em] opacity-60 mb-4 font-bold text-center">Resumen de Inversi√≥n (IVA 8% Zona Fronteriza)</p>
                        
                        <div class="space-y-2 border-b border-white/10 pb-4 mb-4">
                            <div class="flex justify-between text-xs opacity-80">
                                <span>Costo Neto (Subtotal):</span>
                                <span id="resSubtotal" class="font-bold">---</span>
                            </div>
                            <div class="flex justify-between text-xs opacity-80">
                                <span>IVA (8%):</span>
                                <span id="resIva" class="font-bold">---</span>
                            </div>
                        </div>

                        <div class="flex justify-between items-center">
                            <span class="text-sm font-bold uppercase tracking-widest opacity-90">Inversi√≥n Total:</span>
                            <span id="resCostoMXN" class="text-3xl font-black">---</span>
                        </div>
                        
                        <div class="mt-4 pt-3 border-t border-white/10 text-center">
                            <!-- PRECIO USD MAS VISIBLE -->
                            <p id="resCostoUSD" class="text-lg font-bold text-white tracking-wide mb-4">---</p>
                            
                            <!-- LEYENDA DE PAGO -->
                            <p class="text-xs text-gray-300 font-medium italic border-t border-white/10 pt-3">
                                * Se requiere el 50% de anticipo y el resto en contra entrega del proyecto.
                            </p>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between">
                    <button type="button" onclick="nextStep(2)" class="btn-secondary">Anterior</button>
                    <button type="button" onclick="validateStep3()" class="btn-primary">Datos de Contacto <i class="fas fa-chevron-right"></i></button>
                </div>
            </div>

            <!-- PASO 4: CONTACTO -->
            <div id="step4" class="step-content">
                <h2 class="text-xl font-bold text-gray-800 mb-6 border-b pb-2 uppercase tracking-tighter">4. Finalizar Solicitud</h2>
                <div class="space-y-5 mb-8">
                    <div><label class="block text-sm font-bold text-gray-700 mb-1">NOMBRE COMPLETO</label><input type="text" id="nombre" class="input-field" placeholder="Nombre completo" required></div>
                    <div><label class="block text-sm font-bold text-gray-700 mb-1">CORREO ELECTR√ìNICO</label><input type="email" id="email" class="input-field" placeholder="correo@ejemplo.com" required></div>
                    <div>
                        <label class="block text-sm font-bold text-gray-700 mb-1">WHATSAPP / TEL√âFONO</label>
                        <div class="flex">
                            <select id="lada" class="p-3 border border-gray-300 rounded-l-lg bg-gray-50 text-gray-700 border-r-0 focus:ring-gray-800 focus:border-gray-800 outline-none w-28">
                                <option value="+52">üá≤üáΩ +52</option>
                                <option value="+1">üá∫üá∏ +1</option>
                                <option value="+34">üá™üá∏ +34</option>
                                <option value="+57">üá®üá¥ +57</option>
                                <option value="+54">üá¶üá∑ +54</option>
                                <option value="+51">üáµüá™ +51</option>
                                <option value="+56">üá®üá± +56</option>
                                <option value="">üåê Otro</option>
                            </select>
                            <input type="tel" id="telefono" class="w-full p-3 border border-gray-300 rounded-r-lg focus:ring-gray-800 focus:border-gray-800 outline-none transition-all" placeholder="123 456 7890" required>
                        </div>
                    </div>
                </div>
                <div class="flex justify-between">
                    <button type="button" onclick="nextStep(3)" class="btn-secondary">Anterior</button>
                    <button type="submit" class="btn-primary" id="finalSubmit">
                        <span id="btnText">Enviar Solicitud <i class="fas fa-paper-plane"></i></span>
                        <span id="btnSpinner" class="hidden"><i class="fas fa-circle-notch fa-spin"></i> Enviando...</span>
                    </button>
                </div>
            </div>
        </form>
    </main>

    <script>
        let currentStep = 1;
        let selectedPkg = '';
        let totalM2Const = 0;

        window.onload = () => { updateM2(); };

        function toggleSec() { document.getElementById('secContainer').classList.toggle('hidden', !document.getElementById('checkSec').checked); }
        function toggleOtro() { document.getElementById('otroContainer').classList.toggle('hidden', !document.getElementById('checkOtro').checked); }

        function toggleIrregularInputs(valor) {
            const reg = document.getElementById('containerRegular');
            const irreg = document.getElementById('containerIrregular');
            if (valor === 'S√≠') {
                reg.classList.add('hidden');
                irreg.classList.remove('hidden');
            } else {
                reg.classList.remove('hidden');
                irreg.classList.add('hidden');
            }
            calcTerreno();
        }

        function updateM2() {
            let sum = 0;
            document.querySelectorAll('input[name="areasSeleccionadas"]:checked').forEach(c => sum += parseFloat(c.dataset.sqm));
            if (document.getElementById('checkSec').checked) sum += (parseInt(document.getElementById('numSec').value) || 0) * 12;
            if (document.getElementById('checkOtro').checked) sum += (parseFloat(document.getElementById('numOtro').value) || 0);
            totalM2Const = sum;
            document.getElementById('totalM2').innerText = sum.toFixed(2) + ' m¬≤';
        }

        function calcTerreno() {
            const esIrregular = document.querySelector('input[name="terrenoIrregular"]:checked').value === 'S√≠';
            let finalArea = 0;
            if (esIrregular) {
                finalArea = parseFloat(document.getElementById('tAreaManual').value) || 0;
            } else {
                const a = parseFloat(document.getElementById('tAncho').value) || 0;
                const l = parseFloat(document.getElementById('tLargo').value) || 0;
                finalArea = a * l;
            }
            document.getElementById('tArea').innerText = finalArea.toFixed(2) + ' m¬≤';
        }

        function nextStep(n) {
            document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
            document.getElementById('step' + n).classList.add('active');
            currentStep = n;
            window.scrollTo(0,0);
        }

        function prepareStep3() {
            if (totalM2Const <= 0) {
                showModal('Aviso', 'Seleccione al menos un √°rea de construcci√≥n.', 'error');
                return;
            }
            document.getElementById('resM2').innerText = totalM2Const.toFixed(2) + ' m¬≤';
            nextStep(3);
            if (selectedPkg) calculateFinal();
        }

        function selectPackageAndCalc(pkg) {
            selectedPkg = pkg;
            document.querySelectorAll('.package-select').forEach(el => el.classList.remove('selected'));
            document.getElementById('package' + pkg).classList.add('selected');
            calculateFinal();
        }

        function calculateFinal() {
            const precio = selectedPkg === 'Esencial' ? 80 : 130;
            let subtotal = totalM2Const * precio;
            if (selectedPkg === 'Esencial' && subtotal < 4000) subtotal = 4000;
            if (selectedPkg === 'Avanzado' && subtotal < 6500) subtotal = 6500;

            const iva = subtotal * 0.08; 
            const totalMXN = subtotal + iva; 
            const totalUSD = totalMXN / 18.50; 

            document.getElementById('resSubtotal').innerText = '$' + subtotal.toLocaleString('es-MX', {minimumFractionDigits: 2}) + ' MXN';
            document.getElementById('resIva').innerText = '$' + iva.toLocaleString('es-MX', {minimumFractionDigits: 2}) + ' MXN';
            document.getElementById('resCostoMXN').innerText = '$' + totalMXN.toLocaleString('es-MX', {minimumFractionDigits: 2}) + ' MXN';
            document.getElementById('resCostoUSD').innerText = 'EQUIVALENTE A: $' + totalUSD.toLocaleString('en-US', {maximumFractionDigits: 0}) + ' USD APROX.';
        }

        function validateStep3() {
            if (!selectedPkg) { showModal('Selecci√≥n Faltante', 'Elija un paquete para continuar.', 'error'); return; }
            nextStep(4);
        }

        function showModal(title, msg, type) {
            const box = document.getElementById('messageBox');
            const txt = document.getElementById('messageText');
            const loader = document.getElementById('loadingIndicator');
            const btn = document.getElementById('closeMessage');
            txt.innerHTML = `<strong>${title}</strong><br>${msg}`;
            box.classList.remove('hidden');
            if (type === 'loading') { loader.classList.remove('hidden'); btn.classList.add('hidden'); } 
            else { loader.classList.add('hidden'); btn.classList.remove('hidden'); }
        }

        function closeModal() { document.getElementById('messageBox').classList.add('hidden'); }

        document.getElementById('architectureForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const url = document.getElementById('scriptUrl').value;
            const nombre = document.getElementById('nombre').value;
            const email = document.getElementById('email').value;
            const telInput = document.getElementById('telefono').value;
            const lada = document.getElementById('lada').value;
            const tel = lada + ' ' + telInput; // Concatenar Lada y N√∫mero
            
            const esIrregular = document.querySelector('input[name="terrenoIrregular"]:checked').value;
            const largo = document.getElementById('tLargo').value;
            const ancho = document.getElementById('tAncho').value;
            const areaTerrText = document.getElementById('tArea').innerText;
            const tipo = document.getElementById('tipoProyecto');
            const tipoVal = tipo.options[tipo.selectedIndex].value;
            
            showModal('Procesando...', 'Enviando su solicitud a ARKONS...', 'loading');
            document.getElementById('btnText').classList.add('hidden');
            document.getElementById('btnSpinner').classList.remove('hidden');

            const params = new URLSearchParams();
            params.append('nombre', nombre);
            params.append('email', email);
            params.append('telefono', tel);
            params.append('paqueteDeseado', selectedPkg);
            params.append('m2_construccion', totalM2Const.toFixed(2));
            params.append('subtotal', document.getElementById('resSubtotal').innerText);
            params.append('iva_8', document.getElementById('resIva').innerText);
            params.append('costo_total', document.getElementById('resCostoMXN').innerText);
            params.append('costo_usd', document.getElementById('resCostoUSD').innerText);
            params.append('terreno_irregular', esIrregular);
            params.append('terreno_largo', esIrregular === 'No' ? largo : 'N/A');
            params.append('terreno_ancho', esIrregular === 'No' ? ancho : 'N/A');
            params.append('area_terreno', areaTerrText);
            params.append('tipo_proyecto', tipoVal);
            params.append('detalles', document.getElementById('detalles').value);
            params.append('FECHA_DE_ENVIO', new Date().toLocaleString());

            fetch(url, { method: 'POST', mode: 'no-cors', body: params })
            .then(() => {
                showModal('¬°Enviado!', 'Su solicitud ha sido registrada correctamente.', 'success');
                document.getElementById('architectureForm').reset();
                setTimeout(() => location.reload(), 4000);
            })
            .catch(() => { showModal('Error', 'Hubo un problema. Intente nuevamente.', 'error'); })
            .finally(() => {
                document.getElementById('btnText').classList.remove('hidden');
                document.getElementById('btnSpinner').classList.add('hidden');
            });
        });
    </script>
</body>
</html>
